<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>Ø¹Ù„ÙŠ ÙƒØ§Ø¸Ù… Â· Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„ØªÙˆØµÙŠÙ„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, 'Helvetica Neue', sans-serif;
        }

        :root {
            --bg-body: #e2f0ff;
            --bg-app: white;
            --header-bg: #0369a1;
            --header-border: #ffb703;
            --text-primary: #01497c;
            --text-secondary: #02315e;
            --card-bg: #f9fcff;
            --card-border: #cde1f5;
            --input-bg: white;
            --input-border: #c7e0ff;
            --stat-bg: #ecf5ff;
            --stat-border: #9ac2e8;
            --btn-outline: #0284c7;
            --btn-outline-hover: #e1f0ff;
            --btn-primary: #0284c7;
            --btn-primary-hover: #0369a1;
            --modal-bg: white;
            --modal-border: #0284c7;
            --shadow: rgba(0, 70, 150, 0.3);
            --order-notes-bg: #fef7e6;
            --order-notes-border: #ffb703;
            --order-time-bg: #dcfce7;
            --order-time-color: #166534;
            --empty-message: #6b8fb0;
            --chart-bg: #f4f9ff;
            --bar-bg: #0284c7;
            --amount-bg: #d1fae5;
            --amount-color: #065f46;
            --switch-bg: #cbd5e1;
            --switch-active: #0284c7;
        }

        body.dark-mode {
            --bg-body: #121212;
            --bg-app: #1e1e1e;
            --header-bg: #0f3b5e;
            --header-border: #b45309;
            --text-primary: #90caf9;
            --text-secondary: #e0e0e0;
            --card-bg: #2d2d2d;
            --card-border: #404040;
            --input-bg: #333;
            --input-border: #555;
            --stat-bg: #2a2a2a;
            --stat-border: #555;
            --btn-outline: #90caf9;
            --btn-outline-hover: #2a2a2a;
            --btn-primary: #1e4a6d;
            --btn-primary-hover: #0f3b5e;
            --modal-bg: #2d2d2d;
            --modal-border: #90caf9;
            --shadow: rgba(0,0,0,0.7);
            --order-notes-bg: #3e3a2c;
            --order-notes-border: #b45309;
            --order-time-bg: #1e3a2f;
            --order-time-color: #a7f3d0;
            --empty-message: #9e9e9e;
            --chart-bg: #2a2a2a;
            --bar-bg: #90caf9;
            --amount-bg: #1e3a2f;
            --amount-color: #a7f3d0;
            --switch-bg: #4a5568;
            --switch-active: #90caf9;
        }

        body {
            background: var(--bg-body);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 0;
            margin: 0;
        }

        html {
            height: -webkit-fill-available;
        }

        .app-wrapper {
            width: 100%;
            max-width: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            background-color: var(--bg-app);
            box-shadow: none;
            overflow-y: auto;
            overflow-x: hidden;
            border: none;
            display: flex;
            flex-direction: column;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .app-header {
            background: var(--header-bg);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            border-bottom: 4px solid var(--header-border);
            flex-shrink: 0;
        }

        .icon-placeholder {
            background: rgba(255,255,255,0.25);
            width: 48px;
            height: 48px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
            box-shadow: 0 4px 12px rgba(0, 30, 70, 0.3);
            flex-shrink: 0;
        }

        .icon-placeholder span {
            font-size: 28px;
        }

        .app-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-toggle, .dark-mode-toggle {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            cursor: pointer;
            transition: 0.2s;
            flex-shrink: 0;
        }

        .dark-mode-toggle {
            margin-left: 4px;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-bar {
            background: var(--bg-app);
            padding: 10px 12px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
            border-bottom: 2px solid var(--card-border);
            flex-shrink: 0;
        }

        .stat-item, .total-amount, .total-time {
            background: var(--stat-bg);
            padding: 6px 12px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--text-primary);
            border: 1px solid var(--stat-border);
            white-space: nowrap;
        }

        .stat-item span {
            background: var(--btn-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 30px;
            font-size: 0.75rem;
        }

        .total-amount, .total-time {
            background: var(--amount-bg);
            color: var(--amount-color);
            border: 1px solid var(--amount-color);
        }

        /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
        .search-section {
            padding: 10px 12px;
            background: var(--bg-app);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .search-row {
            display: flex;
            gap: 6px;
            align-items: center;
            flex: 1;
            min-width: 200px;
        }

        .search-field {
            flex: 1;
            padding: 10px 12px;
            border: 2px solid var(--input-border);
            border-radius: 40px;
            font-size: 0.9rem;
            background: var(--input-bg);
            color: var(--text-secondary);
            min-width: 120px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--btn-outline);
            color: var(--btn-outline);
            padding: 8px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            transition: 0.15s;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-primary {
            background: var(--btn-primary);
            color: white;
            border-color: var(--btn-primary);
        }

        /* Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© */
        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 0 12px 8px;
            flex-shrink: 0;
        }

        .filter-btn {
            background: transparent;
            border: 2px solid var(--btn-outline);
            color: var(--btn-outline);
            padding: 6px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .filter-btn.active {
            background: #dc2626;
            border-color: #b91c1c;
            color: white;
        }

        .filter-btn.deferred.active {
            background: #f59e0b;
            border-color: #b45309;
        }

        /* Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ… */
        .daily-notes {
            padding: 0 12px 8px;
            flex-shrink: 0;
        }

        .daily-notes textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--input-border);
            border-radius: 30px;
            background: var(--input-bg);
            color: var(--text-secondary);
            resize: vertical;
            min-height: 60px;
            font-size: 0.85rem;
        }

        /* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
        .mini-chart {
            display: flex;
            gap: 6px;
            align-items: flex-end;
            height: 50px;
            margin: 0 12px 10px;
            padding: 5px;
            background: var(--chart-bg);
            border-radius: 40px;
            flex-shrink: 0;
        }

        .bar {
            flex: 1;
            background: var(--bar-bg);
            border-radius: 15px 15px 6px 6px;
            transition: height 0.3s;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
        .main-content {
            padding: 0 12px 16px;
            background: var(--bg-app);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 0 8px 0;
            flex-wrap: wrap;
            color: var(--text-primary);
            font-size: 0.85rem;
            gap: 5px;
            flex-shrink: 0;
        }

        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 2px 2px 10px 2px;
            max-height: none;
        }

        .order-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 14px;
            border: 2px solid var(--card-border);
            box-shadow: 0 4px 8px var(--shadow);
            transition: 0.1s;
            color: var(--text-secondary);
        }

        .order-card.done {
            opacity: 0.6;
            background: var(--stat-bg);
        }

        .order-card.deferred {
            background: #fff3cd;
            border-color: #f59e0b;
        }

        .order-card.cancelled {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .order-region-code {
            background: var(--btn-primary);
            color: white;
            border-radius: 40px;
            padding: 4px 12px;
            font-weight: 600;
            font-size: 0.8rem;
            display: inline-block;
            margin-bottom: 8px;
        }

        .order-detail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 4px 0;
        }

        .order-detail-item {
            background: var(--stat-bg);
            padding: 4px 10px;
            border-radius: 30px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .order-amount {
            background: var(--amount-bg);
            color: var(--amount-color);
            padding: 4px 10px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .order-notes {
            background: var(--order-notes-bg);
            border-radius: 20px;
            padding: 8px;
            margin: 8px 0;
            border-right: 4px solid var(--order-notes-border);
            font-size: 0.8rem;
            word-break: break-word;
        }

        .order-image {
            max-width: 80px;
            max-height: 60px;
            border-radius: 12px;
            margin: 8px 0;
            border: 2px solid var(--btn-outline);
        }

        .order-time {
            background: var(--order-time-bg);
            color: var(--order-time-color);
            border-radius: 30px;
            padding: 4px 10px;
            display: inline-block;
            margin-top: 4px;
            font-size: 0.75rem;
        }

        .order-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .action-btn {
            flex: 1 1 auto;
            background: transparent;
            border: 2px solid var(--btn-outline);
            color: var(--btn-outline);
            border-radius: 40px;
            padding: 6px 8px;
            font-weight: 600;
            font-size: 0.7rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            min-width: 50px;
        }

        .action-btn.whatsapp {
            background: #25D366;
            border-color: #128C7E;
            color: white;
        }

        .action-btn.call {
            background: #34b7f1;
            border-color: #0284c7;
            color: white;
        }

        .action-btn.copy-phone {
            background: #6c757d;
            border-color: #5a6268;
            color: white;
        }

        .action-btn.duplicate {
            background: #6f42c1;
            border-color: #6610f2;
            color: white;
        }

        .action-btn.done-toggle {
            border-color: #0f7b6b;
            color: #0f7b6b;
        }

        .action-btn.done-toggle input {
            margin-left: 4px;
            transform: scale(1);
            accent-color: #0f7b6b;
        }

        .action-btn.edit, .action-btn.delete {
            border-color: #6b7280;
            color: #6b7280;
        }

        .action-btn.delete {
            border-color: #b91c1c;
            color: #b91c1c;
        }

        .rating-stars {
            display: inline-flex;
            gap: 2px;
            margin-right: 5px;
        }

        .star {
            cursor: pointer;
            font-size: 1.1rem;
            color: #ffc107;
        }

        .star.inactive {
            color: #ddd;
        }

        .status-select {
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 40px;
            padding: 4px 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .empty-message {
            text-align: center;
            color: var(--empty-message);
            padding: 30px 20px;
            background: var(--card-bg);
            border-radius: 50px;
            font-size: 0.9rem;
        }

        /* Ù…ÙˆØ¯Ø§Ù„Ø§Øª */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 16px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--modal-bg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            border-radius: 32px;
            padding: 20px;
            box-shadow: 0 30px 40px var(--shadow);
            border: 3px solid var(--modal-border);
            overflow-y: auto;
            color: var(--text-secondary);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.3rem;
        }

        .close-modal {
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--btn-outline);
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1rem;
            border-bottom: 2px solid var(--btn-outline);
            padding-bottom: 4px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: var(--stat-bg);
            border-radius: 40px;
            border: 1px solid var(--stat-border);
        }

        .setting-item label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .setting-item input[type="number"],
        .setting-item input[type="text"],
        .setting-item input[type="password"] {
            width: 120px;
            padding: 6px;
            border: 2px solid var(--input-border);
            border-radius: 30px;
            background: var(--input-bg);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙØ¹ÙŠÙ„ */
        .switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-bg);
            transition: .3s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--switch-active);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-export, .btn-import {
            flex: 1;
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-save {
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 40px;
            font-size: 1rem;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 8px 12px -6px var(--btn-primary);
            margin-top: 16px;
        }

        .region-form {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .region-form input {
            flex: 1 1 100px;
            padding: 8px;
            border: 2px solid var(--input-border);
            border-radius: 40px;
            background: var(--input-bg);
            font-size: 0.9rem;
        }

        .btn-add {
            background: var(--btn-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
        }

        .items-list {
            list-style: none;
            background: var(--stat-bg);
            border-radius: 32px;
            padding: 4px;
        }

        .item-li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            margin: 4px 0;
            padding: 8px 12px;
            border-radius: 40px;
            border: 1px solid var(--card-border);
            font-size: 0.9rem;
        }

        .item-code {
            background: var(--btn-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 30px;
            font-size: 0.75rem;
        }

        .delete-item {
            background: none;
            border: none;
            color: #c00;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .input-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: block;
            font-size: 0.9rem;
        }

        .input-field, .input-select, .input-textarea, .input-priority, .input-number {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--input-border);
            border-radius: 40px;
            background: var(--input-bg);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .input-textarea {
            border-radius: 25px;
            min-height: 70px;
        }

        .file-input {
            padding: 6px;
        }

        .phone-input-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .country-code {
            background: var(--btn-primary);
            color: white;
            padding: 8px 12px;
            border-radius: 40px;
            font-weight: 600;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .phone-input-wrapper .input-field {
            flex: 1;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 380px) {
            .app-header h1 {
                font-size: 1.2rem;
            }
            
            .stat-item, .total-amount, .total-time {
                font-size: 0.7rem;
                padding: 4px 8px;
            }
            
            .btn-outline {
                padding: 6px 8px;
                font-size: 0.7rem;
            }
            
            .order-detail-item {
                font-size: 0.7rem;
                padding: 3px 8px;
            }
            
            .action-btn {
                font-size: 0.65rem;
                padding: 4px 6px;
            }
        }

        /* ØªØ­Ø³ÙŠÙ† Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 768px) {
            .app-wrapper {
                max-width: 600px;
                margin: 0 auto;
                box-shadow: 0 20px 35px -8px var(--shadow);
                border: 1px solid var(--card-border);
                min-height: auto;
                border-radius: 36px;
                margin: 16px auto;
            }
            
            body {
                align-items: center;
                padding: 16px;
            }
            
            .orders-list {
                max-height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯ -->
        <div class="app-header">
            <div class="icon-placeholder"><span>ğŸ“±</span></div>
            <h1>Ø¹Ù„ÙŠ ÙƒØ§Ø¸Ù…</h1>
            <div class="settings-toggle" id="settingsToggle">âš™ï¸</div>
            <div class="dark-mode-toggle" id="darkModeToggle">ğŸŒ™</div>
        </div>

        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-bar">
            <div class="stat-item">ğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ <span id="totalOrders">0</span></div>
            <div class="stat-item">âœ… Ù…ÙÙ†Ø¬Ø² <span id="completedOrders">0</span></div>
            <div class="stat-item">â³ Ù…ØªØ¨Ù‚ÙŠ <span id="pendingOrders">0</span></div>
            <div class="stat-item">ğŸ”´ Ø¹Ø§Ø¬Ù„ <span id="urgentOrders">0</span></div>
            <div class="total-amount" id="totalAmount">ğŸ’° 0 Ø¯.Ø¹</div>
            <div class="total-time" id="totalTime">â±ï¸ 0 Ø¯</div>
        </div>

        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="search-section">
            <div class="search-row">
                <input type="text" id="searchInput" class="search-field" placeholder="ğŸ” Ø¨Ø­Ø« (Ù…Ù†Ø·Ù‚Ø©ØŒ Ø²Ø¨ÙˆÙ†ØŒ ÙƒÙˆØ¯)">
                <button class="btn-outline" id="manageRegionsBtn">ğŸ—‚ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</button>
                <button class="btn-outline btn-primary" id="addOrderBtn">â• Ø¥Ø¶Ø§ÙØ©</button>
            </div>
        </div>

        <!-- Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© -->
        <div class="filters-row" id="extraFilters"></div>

        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ… -->
        <div class="daily-notes" id="dailyNotesSection" style="display: none;">
            <textarea id="dailyNotes" placeholder="ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ… (ØªØ®Ø²Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)"></textarea>
        </div>

        <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ -->
        <div class="mini-chart">
            <div class="bar" style="height:20px" id="barPending"></div>
            <div class="bar" style="height:20px" id="barCompleted"></div>
            <div class="bar" style="height:20px" id="barUrgent"></div>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
        <div class="main-content">
            <div class="orders-header">
                <h3>ğŸšš Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
                <span>(Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©)</span>
            </div>
            <div class="orders-list" id="ordersList">
                <div class="empty-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                <span class="close-modal" id="closeSettingsModal">&times;</span>
            </div>
            <div class="settings-section">
                <h3>ğŸ’° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø­</h3>
                <div class="setting-item">
                    <label>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø«Ø§Ø¨Øª (Ø¯.Ø¹)</label>
                    <input type="number" id="profitAmount" min="0" step="1000" value="2000">
                </div>
            </div>
            <div class="settings-section">
                <h3>âœ… Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>
                <div class="setting-item">
                    <label>Ø­Ø§Ù„Ø§Øª Ù…Ø¤Ø¬Ù„/Ù…Ù„ØºÙŠ</label>
                    <label class="switch">
                        <input type="checkbox" id="enableExtraStatus">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                    <label class="switch">
                        <input type="checkbox" id="enableRegionFilter">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Ø²Ø± ØªÙƒØ±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨</label>
                    <label class="switch">
                        <input type="checkbox" id="enableDuplicate">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…</label>
                    <label class="switch">
                        <input type="checkbox" id="enableDailyNotes">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·</label>
                    <label class="switch">
                        <input type="checkbox" id="enableDailyTime">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…</label>
                    <label class="switch">
                        <input type="checkbox" id="enableCopyPhone">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØµÙˆØªÙŠØ©</label>
                    <label class="switch">
                        <input type="checkbox" id="enableSounds">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</label>
                    <label class="switch">
                        <input type="checkbox" id="enableRatings">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <label>Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</label>
                    <label class="switch">
                        <input type="checkbox" id="enableMaps">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <h3>ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                <div class="btn-group">
                    <button class="btn-export" id="exportData">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
                    <button class="btn-import" id="importData">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
            <button class="btn-save" id="saveSettings">ğŸ’¾ Ø­ÙØ¸</button>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨</h2>
                <span class="close-modal" id="closeOrderModalBtn">&times;</span>
            </div>
            <form id="orderForm">
                <div class="form-grid">
                    <div class="full-width">
                        <label class="input-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                        <select id="orderRegion" class="input-select" required>
                            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>
                        </select>
                    </div>
                    <div class="full-width">
                        <label class="input-label">Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
                        <input type="text" id="customerName" class="input-field" required>
                    </div>
                    <div class="full-width">
                        <label class="input-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <div class="phone-input-wrapper">
                            <span class="country-code">+964</span>
                            <input type="tel" id="customerPhone" class="input-field" required placeholder="077Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—" dir="ltr">
                        </div>
                        <small style="color: var(--text-secondary); display: block; margin-top: 4px;">11 Ø±Ù‚Ù…Ù‹Ø§ØŒ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 077 Ø£Ùˆ 078 Ø£Ùˆ 079</small>
                    </div>
                    <div>
                        <label class="input-label">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)</label>
                        <input type="number" id="orderAmount" class="input-number" min="0" step="0.01" required>
                    </div>
                    <div>
                        <label class="input-label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="orderPriority" class="input-priority">
                            <option value="Ø¹Ø§Ø¯ÙŠ">ğŸŸ¡ Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="Ø¹Ø§Ø¬Ù„">ğŸ”´ Ø¹Ø§Ø¬Ù„</option>
                        </select>
                    </div>
                    <div>
                        <label class="input-label">ØµÙˆØ±Ø©</label>
                        <input type="file" id="orderImage" accept="image/*" class="input-field file-input">
                    </div>
                    <div class="full-width">
                        <label class="input-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="customerNotes" class="input-textarea" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn-save">ğŸ’¾ Ø­ÙØ¸</button>
            </form>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ -->
    <div class="modal" id="regionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ—‚ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
                <span class="close-modal" id="closeModalBtn">&times;</span>
            </div>
            <div class="region-form">
                <input type="text" id="regionName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
                <input type="text" id="regionCode" placeholder="ÙƒÙˆØ¯">
                <button class="btn-add" id="addRegionBtn">â•</button>
            </div>
            <ul class="items-list" id="regionsList"></ul>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
                <span class="close-modal" id="closeEditModalBtn">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editOrderId">
                <div class="form-grid">
                    <div class="full-width">
                        <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                        <select id="editRegion" class="input-select" required></select>
                    </div>
                    <div class="full-width">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</label>
                        <input type="text" id="editCustomerName" class="input-field" required>
                    </div>
                    <div class="full-width">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <div class="phone-input-wrapper">
                            <span class="country-code">+964</span>
                            <input type="tel" id="editCustomerPhone" class="input-field" required placeholder="077Ã—Ã—Ã—Ã—Ã—Ã—Ã—Ã—" dir="ltr">
                        </div>
                    </div>
                    <div>
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)</label>
                        <input type="number" id="editAmount" class="input-number" min="0" step="0.01" required>
                    </div>
                    <div>
                        <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                        <select id="editPriority" class="input-priority">
                            <option value="Ø¹Ø§Ø¯ÙŠ">ğŸŸ¡ Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="Ø¹Ø§Ø¬Ù„">ğŸ”´ Ø¹Ø§Ø¬Ù„</option>
                        </select>
                    </div>
                    <div class="full-width">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="editNotes" class="input-textarea"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn-save">ğŸ’¾ Ø­ÙØ¸</button>
            </form>
        </div>
    </div>

    <script>
        (function() {
            'use strict';

            const REGIONS_KEY = 'delivery_regions_pro';
            const ORDERS_KEY = 'delivery_orders_pro_v8';
            const DARK_MODE_KEY = 'dark_mode';
            const SETTINGS_KEY = 'app_settings';
            const DAILY_NOTES_KEY = 'daily_notes';

            let regions = [];
            let orders = [];
            let settings = {
                profitAmount: 2000,
                enableExtraStatus: false,
                enableRegionFilter: false,
                enableDuplicate: false,
                enableAdvancedStats: false,
                enableDailyNotes: false,
                enableDailyTime: true,
                enableCopyPhone: false,
                enableSounds: false,
                enableRatings: false,
                enableMaps: false,
                enableAdmin: false,
                adminPassword: '1234'
            };

            let showUrgentOnly = false;
            let showDeferredOnly = false;
            let showCancelledOnly = false;
            let selectedRegion = '';

            // Ø¹Ù†Ø§ØµØ± DOM
            const regionSelect = document.getElementById('orderRegion');
            const ordersListDiv = document.getElementById('ordersList');
            const totalSpan = document.getElementById('totalOrders');
            const completedSpan = document.getElementById('completedOrders');
            const pendingSpan = document.getElementById('pendingOrders');
            const urgentSpan = document.getElementById('urgentOrders');
            const totalAmountSpan = document.getElementById('totalAmount');
            const totalTimeSpan = document.getElementById('totalTime');
            const searchInput = document.getElementById('searchInput');
            const manageRegionsBtn = document.getElementById('manageRegionsBtn');
            const addOrderBtn = document.getElementById('addOrderBtn');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsModal = document.getElementById('settingsModal');
            const closeSettingsModal = document.getElementById('closeSettingsModal');
            const extraFiltersDiv = document.getElementById('extraFilters');
            const dailyNotesSection = document.getElementById('dailyNotesSection');
            const dailyNotes = document.getElementById('dailyNotes');
            const darkModeToggle = document.getElementById('darkModeToggle');

            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            const profitAmountInput = document.getElementById('profitAmount');
            const enableExtraStatusCheck = document.getElementById('enableExtraStatus');
            const enableRegionFilterCheck = document.getElementById('enableRegionFilter');
            const enableDuplicateCheck = document.getElementById('enableDuplicate');
            const enableDailyNotesCheck = document.getElementById('enableDailyNotes');
            const enableDailyTimeCheck = document.getElementById('enableDailyTime');
            const enableCopyPhoneCheck = document.getElementById('enableCopyPhone');
            const enableSoundsCheck = document.getElementById('enableSounds');
            const enableRatingsCheck = document.getElementById('enableRatings');
            const enableMapsCheck = document.getElementById('enableMaps');
            const saveSettingsBtn = document.getElementById('saveSettings');
            const exportDataBtn = document.getElementById('exportData');
            const importDataBtn = document.getElementById('importData');
            const importFile = document.getElementById('importFile');

            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
            const regionModal = document.getElementById('regionModal');
            const orderModal = document.getElementById('orderModal');
            const editModal = document.getElementById('editModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const closeOrderModalBtn = document.getElementById('closeOrderModalBtn');
            const closeEditModalBtn = document.getElementById('closeEditModalBtn');
            const regionsListUl = document.getElementById('regionsList');
            const addRegionBtn = document.getElementById('addRegionBtn');
            const regionNameInput = document.getElementById('regionName');
            const regionCodeInput = document.getElementById('regionCode');

            // Ø¹Ù†Ø§ØµØ± Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            const orderForm = document.getElementById('orderForm');
            const customerNameInput = document.getElementById('customerName');
            const customerPhoneInput = document.getElementById('customerPhone');
            const customerNotesInput = document.getElementById('customerNotes');
            const orderPriorityInput = document.getElementById('orderPriority');
            const orderAmountInput = document.getElementById('orderAmount');
            const orderImageInput = document.getElementById('orderImage');

            const editForm = document.getElementById('editForm');
            const editOrderId = document.getElementById('editOrderId');
            const editRegion = document.getElementById('editRegion');
            const editCustomerName = document.getElementById('editCustomerName');
            const editCustomerPhone = document.getElementById('editCustomerPhone');
            const editAmount = document.getElementById('editAmount');
            const editPriority = document.getElementById('editPriority');
            const editNotes = document.getElementById('editNotes');

            // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
            function formatAmount(amount) {
                if (amount == null || isNaN(amount)) return '0';
                return amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ (11 Ø±Ù‚Ù…ØŒ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 077 Ø£Ùˆ 078 Ø£Ùˆ 079)
            function validateIraqiPhone(phone) {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª
                let cleaned = phone.replace(/\s+/g, '').replace(/-/g, '');
                // ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
                if (!/^\d+$/.test(cleaned)) return false;
                // ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 077 Ø£Ùˆ 078 Ø£Ùˆ 079
                if (!cleaned.startsWith('077') && !cleaned.startsWith('078') && !cleaned.startsWith('079')) return false;
                // Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ 11 Ø±Ù‚Ù…
                return cleaned.length === 11;
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª)
            function cleanPhoneNumber(phone) {
                return phone.replace(/\s+/g, '').replace(/[^\d]/g, '');
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­
            function getFullPhoneNumber(localNumber) {
                const cleaned = cleanPhoneNumber(localNumber);
                return '964' + cleaned;
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            function loadSettings() {
                const saved = localStorage.getItem(SETTINGS_KEY);
                if (saved) {
                    try {
                        settings = { ...settings, ...JSON.parse(saved) };
                    } catch (e) {}
                }
                profitAmountInput.value = settings.profitAmount;
                enableExtraStatusCheck.checked = settings.enableExtraStatus;
                enableRegionFilterCheck.checked = settings.enableRegionFilter;
                enableDuplicateCheck.checked = settings.enableDuplicate;
                enableDailyNotesCheck.checked = settings.enableDailyNotes;
                enableDailyTimeCheck.checked = settings.enableDailyTime;
                enableCopyPhoneCheck.checked = settings.enableCopyPhone;
                enableSoundsCheck.checked = settings.enableSounds;
                enableRatingsCheck.checked = settings.enableRatings;
                enableMapsCheck.checked = settings.enableMaps;

                updateUIBasedOnSettings();
            }

            function saveSettings() {
                settings = {
                    profitAmount: parseFloat(profitAmountInput.value) || 2000,
                    enableExtraStatus: enableExtraStatusCheck.checked,
                    enableRegionFilter: enableRegionFilterCheck.checked,
                    enableDuplicate: enableDuplicateCheck.checked,
                    enableAdvancedStats: false,
                    enableDailyNotes: enableDailyNotesCheck.checked,
                    enableDailyTime: enableDailyTimeCheck.checked,
                    enableCopyPhone: enableCopyPhoneCheck.checked,
                    enableSounds: enableSoundsCheck.checked,
                    enableRatings: enableRatingsCheck.checked,
                    enableMaps: enableMapsCheck.checked,
                    enableAdmin: false,
                    adminPassword: '1234'
                };
                localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
                updateUIBasedOnSettings();
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }

            function updateUIBasedOnSettings() {
                let filtersHtml = '<button class="filter-btn" id="filterUrgentBtn">ğŸ”´ Ø¹Ø§Ø¬Ù„ ÙÙ‚Ø·</button>';
                if (settings.enableExtraStatus) {
                    filtersHtml += '<button class="filter-btn deferred" id="filterDeferredBtn">â±ï¸ Ù…Ø¤Ø¬Ù„ ÙÙ‚Ø·</button>';
                    filtersHtml += '<button class="filter-btn" id="filterCancelledBtn">âŒ Ù…Ù„ØºÙŠ ÙÙ‚Ø·</button>';
                }
                if (settings.enableRegionFilter && regions.length > 0) {
                    let regionOptions = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>';
                    regions.forEach(r => {
                        regionOptions += `<option value="${r.id}">${r.name}</option>`;
                    });
                    filtersHtml += `<select id="regionFilterSelect" class="btn-outline" style="min-width:120px;">${regionOptions}</select>`;
                }
                extraFiltersDiv.innerHTML = filtersHtml;

                document.getElementById('filterUrgentBtn')?.addEventListener('click', toggleUrgentFilter);
                if (settings.enableExtraStatus) {
                    document.getElementById('filterDeferredBtn')?.addEventListener('click', toggleDeferredFilter);
                    document.getElementById('filterCancelledBtn')?.addEventListener('click', toggleCancelledFilter);
                }
                if (settings.enableRegionFilter) {
                    document.getElementById('regionFilterSelect')?.addEventListener('change', (e) => {
                        selectedRegion = e.target.value;
                        renderOrders();
                    });
                }

                if (settings.enableDailyNotes) {
                    dailyNotesSection.style.display = 'block';
                    dailyNotes.value = localStorage.getItem(DAILY_NOTES_KEY) || '';
                } else {
                    dailyNotesSection.style.display = 'none';
                }

                updateStats();
            }

            function toggleUrgentFilter() {
                showUrgentOnly = !showUrgentOnly;
                if (showUrgentOnly) {
                    showDeferredOnly = false;
                    showCancelledOnly = false;
                }
                updateFilterButtons();
                renderOrders();
            }

            function toggleDeferredFilter() {
                showDeferredOnly = !showDeferredOnly;
                if (showDeferredOnly) {
                    showUrgentOnly = false;
                    showCancelledOnly = false;
                }
                updateFilterButtons();
                renderOrders();
            }

            function toggleCancelledFilter() {
                showCancelledOnly = !showCancelledOnly;
                if (showCancelledOnly) {
                    showUrgentOnly = false;
                    showDeferredOnly = false;
                }
                updateFilterButtons();
                renderOrders();
            }

            function updateFilterButtons() {
                const urgentBtn = document.getElementById('filterUrgentBtn');
                const deferredBtn = document.getElementById('filterDeferredBtn');
                const cancelledBtn = document.getElementById('filterCancelledBtn');
                if (urgentBtn) urgentBtn.classList.toggle('active', showUrgentOnly);
                if (deferredBtn) deferredBtn.classList.toggle('active', showDeferredOnly);
                if (cancelledBtn) cancelledBtn.classList.toggle('active', showCancelledOnly);
            }

            // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            function loadDarkMode() {
                const dark = localStorage.getItem(DARK_MODE_KEY) === 'true';
                document.body.classList.toggle('dark-mode', dark);
                darkModeToggle.textContent = dark ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem(DARK_MODE_KEY, isDark);
                darkModeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            darkModeToggle.addEventListener('click', toggleDarkMode);
            loadDarkMode();

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            function loadRegions() {
                try {
                    const stored = localStorage.getItem(REGIONS_KEY);
                    regions = stored ? JSON.parse(stored) : [];
                    if (!Array.isArray(regions)) regions = [];
                } catch { regions = []; }
                regions.sort((a, b) => (Number(a.code) || a.code) - (Number(b.code) || b.code));
            }
            function loadOrders() {
                try {
                    const stored = localStorage.getItem(ORDERS_KEY);
                    orders = stored ? JSON.parse(stored) : [];
                    if (!Array.isArray(orders)) orders = [];
                } catch { orders = []; }
            }
            function saveRegions() { localStorage.setItem(REGIONS_KEY, JSON.stringify(regions)); }
            function saveOrders() { localStorage.setItem(ORDERS_KEY, JSON.stringify(orders)); }

            function populateRegionSelect(targetSelect = regionSelect) {
                targetSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>';
                regions.forEach(r => {
                    const option = document.createElement('option');
                    option.value = r.id;
                    option.textContent = `${r.name} (ÙƒÙˆØ¯ ${r.code})`;
                    targetSelect.appendChild(option);
                });
            }

            function renderRegionsList() {
                regionsListUl.innerHTML = '';
                if (regions.length === 0) {
                    regionsListUl.innerHTML = '<li style="text-align:center; padding:1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø¹Ø¯</li>';
                    return;
                }
                regions.forEach((region, index) => {
                    const li = document.createElement('li');
                    li.className = 'item-li';
                    li.innerHTML = `
                        <span><strong>${escapeHTML(region.name)}</strong> <span class="item-code">${escapeHTML(region.code)}</span></span>
                        <button class="delete-item" data-index="${index}">ğŸ—‘</button>
                    `;
                    regionsListUl.appendChild(li);
                });
                document.querySelectorAll('.delete-item').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const idx = btn.getAttribute('data-index');
                        if (idx !== null) {
                            const regionId = regions[idx]?.id;
                            if (orders.some(o => o.regionId === regionId)) {
                                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ø£Ù† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø§.');
                                return;
                            }
                            regions.splice(idx, 1);
                            saveRegions();
                            loadRegions();
                            renderRegionsList();
                            populateRegionSelect();
                            renderOrders();
                        }
                    });
                });
            }

            function addRegion() {
                const name = regionNameInput.value.trim();
                const code = regionCodeInput.value.trim();
                if (!name || !code) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯');
                if (regions.some(r => r.code === code)) return alert('Ø§Ù„ÙƒÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                regions.push({ id: 'r_' + Date.now() + Math.random().toString(36).substr(2,5), name, code });
                saveRegions();
                loadRegions();
                regionNameInput.value = '';
                regionCodeInput.value = '';
                renderRegionsList();
                populateRegionSelect();
            }

            function addOrder(event) {
                event.preventDefault();
                const regionId = regionSelect.value;
                const customerName = customerNameInput.value.trim();
                let customerPhone = customerPhoneInput.value.trim();
                const customerNotes = customerNotesInput.value.trim();
                const priority = orderPriorityInput.value;
                const amount = parseFloat(orderAmountInput.value) || settings.profitAmount;
                const imageFile = orderImageInput.files[0];

                if (!regionId || !customerName || !customerPhone) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
                    return;
                }

                const cleanedLocal = cleanPhoneNumber(customerPhone);
                if (!validateIraqiPhone(cleanedLocal)) {
                    alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¹Ø±Ø§Ù‚ÙŠ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 11 Ø±Ù‚Ù…Ù‹Ø§ ÙˆÙŠØ¨Ø¯Ø£ Ø¨Ù€ 077 Ø£Ùˆ 078 Ø£Ùˆ 079');
                    return;
                }
                customerPhone = cleanedLocal;

                const reader = new FileReader();
                reader.onload = function(e) {
                    const now = Date.now();
                    const newOrder = {
                        id: 'o_' + Date.now() + Math.random().toString(36).substr(2,5),
                        regionId,
                        customerName,
                        customerPhone,
                        customerNotes,
                        priority,
                        amount: amount,
                        image: e.target.result || null,
                        status: 'pending',
                        rating: 0,
                        startTime: now,
                        endTime: null,
                        duration: null
                    };
                    orders.push(newOrder);
                    saveOrders();

                    if (settings.enableSounds) {
                        new Audio('data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YUkAAABAAgAZGF0YUkAAAABAAgAZGF0YUkAAAABAAgAZGF0YUkAAAABAAgAZGF0YUkAAAABAAgAZGF0YUkAAAABAAgAZGF0YUkAAAABAAgAZGF0YUkA').play().catch(() => {});
                    }

                    customerNameInput.value = '';
                    customerPhoneInput.value = '';
                    customerNotesInput.value = '';
                    orderAmountInput.value = '';
                    orderImageInput.value = '';
                    orderModal.classList.remove('show');
                    renderOrders();
                };
                if (imageFile) {
                    reader.readAsDataURL(imageFile);
                } else {
                    reader.onload({ target: { result: null } });
                }
            }

            function getSortedOrders() {
                const regionMap = Object.fromEntries(regions.map(r => [r.id, r]));
                return [...orders].sort((a, b) => {
                    const codeA = regionMap[a.regionId]?.code || '';
                    const codeB = regionMap[b.regionId]?.code || '';
                    return (Number(codeA) || codeA) - (Number(codeB) || codeB);
                });
            }

            function changeStatus(orderId, newStatus) {
                const order = orders.find(o => o.id === orderId);
                if (!order) return;

                const now = Date.now();
                if (newStatus === 'done' && order.status !== 'done') {
                    order.endTime = now;
                    order.duration = now - order.startTime;
                    const sorted = getSortedOrders();
                    const currentIndex = sorted.findIndex(o => o.id === orderId);
                    if (currentIndex !== -1) {
                        for (let i = currentIndex + 1; i < sorted.length; i++) {
                            const next = sorted[i];
                            if (next.status === 'pending') {
                                next.startTime = now;
                                break;
                            }
                        }
                    }
                } else if (order.status === 'done' && newStatus !== 'done') {
                    order.endTime = null;
                    order.duration = null;
                }
                order.status = newStatus;
                saveOrders();
                renderOrders();
            }

            function setRating(orderId, rating) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.rating = rating;
                    saveOrders();
                    renderOrders();
                }
            }

            function duplicateOrder(orderId) {
                const original = orders.find(o => o.id === orderId);
                if (!original) return;

                const now = Date.now();
                const newOrder = {
                    ...original,
                    id: 'o_' + Date.now() + Math.random().toString(36).substr(2,5),
                    status: 'pending',
                    rating: 0,
                    startTime: now,
                    endTime: null,
                    duration: null,
                    customerNotes: original.customerNotes + ' (Ù†Ø³Ø®Ø©)'
                };
                orders.push(newOrder);
                saveOrders();
                renderOrders();
            }

            function openMaps(regionName) {
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(regionName)}`, '_blank');
            }

            function renderOrders() {
                const regionMap = Object.fromEntries(regions.map(r => [r.id, r]));
                const sorted = getSortedOrders();

                const searchTerm = searchInput.value.trim().toLowerCase();
                let filtered = sorted;

                if (searchTerm) {
                    filtered = sorted.filter(o => {
                        const region = regionMap[o.regionId];
                        return (region?.name?.toLowerCase().includes(searchTerm) ||
                                region?.code?.toLowerCase().includes(searchTerm) ||
                                o.customerName.toLowerCase().includes(searchTerm) ||
                                o.customerPhone.includes(searchTerm));
                    });
                }

                if (showUrgentOnly) {
                    filtered = filtered.filter(o => o.priority === 'Ø¹Ø§Ø¬Ù„');
                }
                if (showDeferredOnly) {
                    filtered = filtered.filter(o => o.status === 'deferred');
                }
                if (showCancelledOnly) {
                    filtered = filtered.filter(o => o.status === 'cancelled');
                }
                if (selectedRegion) {
                    filtered = filtered.filter(o => o.regionId === selectedRegion);
                }

                if (!filtered.length) {
                    ordersListDiv.innerHTML = '<div class="empty-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                    updateStats();
                    return;
                }

                let html = '';
                filtered.forEach(order => {
                    const region = regionMap[order.regionId] || { name: 'Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø°ÙˆÙØ©', code: '?' };
                    let statusClass = '';
                    if (order.status === 'done') statusClass = 'done';
                    else if (order.status === 'deferred') statusClass = 'deferred';
                    else if (order.status === 'cancelled') statusClass = 'cancelled';

                    const fullPhone = getFullPhoneNumber(order.customerPhone);
                    const waMessage = encodeURIComponent(`Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ø·Ù„Ø¨Ùƒ Ù…Ù† Ù…Ù†Ø·Ù‚Ø© ${region.name} (ÙƒÙˆØ¯ ${region.code})ØŒ Ø§Ù„Ø²Ø¨ÙˆÙ†: ${order.customerName}. Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(order.amount)} Ø¯.Ø¹. Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${order.customerNotes || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}`);
                    const waLink = fullPhone ? `https://wa.me/${fullPhone}?text=${waMessage}` : '#';
                    const telLink = fullPhone ? `tel:+${fullPhone}` : '#';

                    let timeText = '';
                    if (order.status === 'done' && order.duration) {
                        const minutes = Math.floor(order.duration / 60000);
                        const seconds = Math.floor((order.duration % 60000) / 1000);
                        timeText = `â±ï¸ Ø§Ø³ØªØºØ±Ù‚: ${minutes} Ø¯ ${seconds} Ø«`;
                    } else if (order.status === 'pending' && order.startTime) {
                        const elapsed = Date.now() - order.startTime;
                        const minutes = Math.floor(elapsed / 60000);
                        const seconds = Math.floor((elapsed % 60000) / 1000);
                        timeText = `â³ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°: ${minutes} Ø¯ ${seconds} Ø«`;
                    }

                    let statusOptions = `
                        <select class="status-select" data-id="${order.id}">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>â³ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</option>
                            <option value="done" ${order.status === 'done' ? 'selected' : ''}>âœ… ØªÙ…</option>
                    `;
                    if (settings.enableExtraStatus) {
                        statusOptions += `
                            <option value="deferred" ${order.status === 'deferred' ? 'selected' : ''}>â±ï¸ Ù…Ø¤Ø¬Ù„</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>âŒ Ù…Ù„ØºÙŠ</option>
                        `;
                    }
                    statusOptions += `</select>`;

                    let ratingHtml = '';
                    if (settings.enableRatings) {
                        let stars = '';
                        for (let i = 1; i <= 5; i++) {
                            stars += `<span class="star ${i <= order.rating ? '' : 'inactive'}" data-order="${order.id}" data-rating="${i}">â˜…</span>`;
                        }
                        ratingHtml = `<div class="rating-stars">${stars}</div>`;
                    }

                    let extraButtons = '';
                    if (settings.enableDuplicate) {
                        extraButtons += `<button class="action-btn duplicate" data-id="${order.id}">ğŸ“‹ Ù†Ø³Ø®</button>`;
                    }
                    if (settings.enableCopyPhone) {
                        extraButtons += `<button class="action-btn copy-phone" data-id="${order.id}">ğŸ“‹ Ø±Ù‚Ù…</button>`;
                    }
                    if (settings.enableMaps) {
                        extraButtons += `<button class="action-btn maps" data-region="${region.name}">ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø©</button>`;
                    }

                    html += `
                        <div class="order-card ${statusClass}" data-order-id="${order.id}">
                            <div class="order-region-code">${escapeHTML(region.name)} Â· ÙƒÙˆØ¯ ${escapeHTML(region.code)}</div>
                            ${ratingHtml}
                            <div class="order-detail-row">
                                <div class="order-detail-item"><strong>Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> <span>${escapeHTML(order.customerName)}</span></div>
                                <div class="order-detail-item"><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> <span dir="ltr">+964 ${escapeHTML(order.customerPhone)}</span></div>
                                <div class="order-detail-item"><strong>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</strong> <span>${order.priority === 'Ø¹Ø§Ø¬Ù„' ? 'ğŸ”´ Ø¹Ø§Ø¬Ù„' : 'ğŸŸ¡ Ø¹Ø§Ø¯ÙŠ'}</span></div>
                                <div class="order-detail-item"><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${statusOptions}</div>
                                <div class="order-amount"><strong>ğŸ’°</strong> ${formatAmount(order.amount)} Ø¯.Ø¹</div>
                            </div>
                            ${order.customerNotes ? `<div class="order-notes">ğŸ“ ${escapeHTML(order.customerNotes)}</div>` : ''}
                            ${order.image ? `<img src="${order.image}" class="order-image" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨">` : ''}
                            ${timeText ? `<div class="order-time">${timeText}</div>` : ''}
                            <div class="order-actions">
                                <a class="action-btn call" href="${telLink}" target="_blank">ğŸ“ Ø§ØªØµØ§Ù„</a>
                                <a class="action-btn whatsapp" href="${waLink}" target="_blank">ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨</a>
                                ${extraButtons}
                                <label class="action-btn done-toggle">
                                    <input type="checkbox" class="done-checkbox" data-id="${order.id}" ${order.status === 'done' ? 'checked' : ''}> ØªÙ…
                                </label>
                                <button class="action-btn edit" data-id="${order.id}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="action-btn delete" data-id="${order.id}">ğŸ—‘ Ø­Ø°Ù</button>
                            </div>
                        </div>
                    `;
                });

                ordersListDiv.innerHTML = html;

                document.querySelectorAll('.status-select').forEach(select => {
                    select.addEventListener('change', function() {
                        changeStatus(this.dataset.id, this.value);
                    });
                });

                document.querySelectorAll('.done-checkbox').forEach(cb => {
                    cb.addEventListener('change', function() {
                        changeStatus(this.dataset.id, this.checked ? 'done' : 'pending');
                    });
                });

                document.querySelectorAll('.action-btn.edit').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.dataset.id;
                        const order = orders.find(o => o.id === orderId);
                        if (order) openEditModal(order);
                    });
                });

                document.querySelectorAll('.action-btn.delete').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const orderId = btn.dataset.id;
                        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                            orders = orders.filter(o => o.id !== orderId);
                            saveOrders();
                            renderOrders();
                        }
                    });
                });

                if (settings.enableDuplicate) {
                    document.querySelectorAll('.action-btn.duplicate').forEach(btn => {
                        btn.addEventListener('click', () => duplicateOrder(btn.dataset.id));
                    });
                }

                if (settings.enableCopyPhone) {
                    document.querySelectorAll('.action-btn.copy-phone').forEach(btn => {
                        btn.addEventListener('click', async () => {
                            const order = orders.find(o => o.id === btn.dataset.id);
                            if (order) {
                                const fullPhone = getFullPhoneNumber(order.customerPhone);
                                await navigator.clipboard.writeText('+' + fullPhone);
                                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…: +' + fullPhone);
                            }
                        });
                    });
                }

                if (settings.enableMaps) {
                    document.querySelectorAll('.action-btn.maps').forEach(btn => {
                        btn.addEventListener('click', () => openMaps(btn.dataset.region));
                    });
                }

                if (settings.enableRatings) {
                    document.querySelectorAll('.star').forEach(star => {
                        star.addEventListener('click', function() {
                            const orderId = this.dataset.order;
                            const rating = parseInt(this.dataset.rating);
                            setRating(orderId, rating);
                        });
                    });
                }

                updateStats();
                updateChart();
            }

            function openEditModal(order) {
                editOrderId.value = order.id;
                populateRegionSelect(editRegion);
                editRegion.value = order.regionId;
                editCustomerName.value = order.customerName;
                editCustomerPhone.value = order.customerPhone;
                editAmount.value = order.amount;
                editPriority.value = order.priority || 'Ø¹Ø§Ø¯ÙŠ';
                editNotes.value = order.customerNotes || '';
                editModal.classList.add('show');
            }

            function handleEditSubmit(e) {
                e.preventDefault();
                const id = editOrderId.value;
                const order = orders.find(o => o.id === id);
                if (!order) return;

                let customerPhone = editCustomerPhone.value.trim();
                const cleanedLocal = cleanPhoneNumber(customerPhone);
                if (!validateIraqiPhone(cleanedLocal)) {
                    alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¹Ø±Ø§Ù‚ÙŠ ØµØ­ÙŠØ­ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 077 Ø£Ùˆ 078 Ø£Ùˆ 079 ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 11 Ø±Ù‚Ù…Ù‹Ø§');
                    return;
                }

                order.regionId = editRegion.value;
                order.customerName = editCustomerName.value.trim();
                order.customerPhone = cleanedLocal;
                order.amount = parseFloat(editAmount.value) || settings.profitAmount;
                order.priority = editPriority.value;
                order.customerNotes = editNotes.value.trim();

                saveOrders();
                editModal.classList.remove('show');
                renderOrders();
            }

            function updateStats() {
                const total = orders.length;
                const completed = orders.filter(o => o.status === 'done').length;
                const pending = orders.filter(o => o.status === 'pending').length;
                const urgent = orders.filter(o => o.priority === 'Ø¹Ø§Ø¬Ù„' && o.status === 'pending').length;
                
                const todayStart = new Date().setHours(0,0,0,0);
                const todayEnd = new Date().setHours(23,59,59,999);
                const todayDelivered = orders.filter(o => o.status === 'done' && o.endTime >= todayStart && o.endTime <= todayEnd);
                const todayProfit = todayDelivered.reduce((sum, o) => sum + (o.amount || 0), 0);
                
                const totalMinutes = orders
                    .filter(o => o.status === 'done' && o.duration)
                    .reduce((sum, o) => sum + o.duration, 0) / 60000;

                const todayMinutes = todayDelivered
                    .reduce((sum, o) => sum + (o.duration || 0), 0) / 60000;
                
                totalSpan.textContent = total;
                completedSpan.textContent = completed;
                pendingSpan.textContent = pending;
                urgentSpan.textContent = urgent;
                totalAmountSpan.innerHTML = `ğŸ’° ${formatAmount(todayProfit)} Ø¯.Ø¹`;
                totalTimeSpan.innerHTML = `â±ï¸ ${(settings.enableDailyTime ? todayMinutes : totalMinutes).toFixed(1)} Ø¯`;
            }

            function updateChart() {
                const total = orders.length || 1;
                const pending = orders.filter(o => o.status === 'pending').length;
                const completed = orders.filter(o => o.status === 'done').length;
                const urgent = orders.filter(o => o.priority === 'Ø¹Ø§Ø¬Ù„' && o.status === 'pending').length;

                const maxHeight = 35;
                document.getElementById('barPending').style.height = (pending / total * maxHeight) + 'px';
                document.getElementById('barCompleted').style.height = (completed / total * maxHeight) + 'px';
                document.getElementById('barUrgent').style.height = (urgent / total * maxHeight) + 'px';
            }

            function escapeHTML(str) {
                if (!str) return '';
                return String(str).replace(/[&<>"]/g, function(m) {
                    if (m === '&') return '&amp;';
                    if (m === '<') return '&lt;';
                    if (m === '>') return '&gt;';
                    if (m === '"') return '&quot;';
                    return m;
                });
            }

            function exportData() {
                const data = { regions, orders, settings };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Ø¹Ù„ÙŠ_ÙƒØ§Ø¸Ù…_Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
            }

            function importData() {
                importFile.click();
            }

            importFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.regions) regions = data.regions;
                        if (data.orders) orders = data.orders;
                        if (data.settings) settings = { ...settings, ...data.settings };
                        saveRegions();
                        saveOrders();
                        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
                        loadSettings();
                        populateRegionSelect();
                        renderOrders();
                        alert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    } catch (err) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                    }
                };
                reader.readAsText(file);
                importFile.value = '';
            });

            // Ø£Ø­Ø¯Ø§Ø«
            searchInput.addEventListener('input', renderOrders);

            manageRegionsBtn.addEventListener('click', () => {
                renderRegionsList();
                regionModal.classList.add('show');
            });
            closeModalBtn.addEventListener('click', () => regionModal.classList.remove('show'));
            window.addEventListener('click', (e) => { if (e.target === regionModal) regionModal.classList.remove('show'); });

            addOrderBtn.addEventListener('click', () => {
                populateRegionSelect(regionSelect);
                orderAmountInput.value = settings.profitAmount;
                orderModal.classList.add('show');
            });
            closeOrderModalBtn.addEventListener('click', () => orderModal.classList.remove('show'));
            window.addEventListener('click', (e) => { if (e.target === orderModal) orderModal.classList.remove('show'); });

            addRegionBtn.addEventListener('click', (e) => { e.preventDefault(); addRegion(); });

            orderForm.addEventListener('submit', addOrder);

            editForm.addEventListener('submit', handleEditSubmit);
            closeEditModalBtn.addEventListener('click', () => editModal.classList.remove('show'));
            window.addEventListener('click', (e) => { if (e.target === editModal) editModal.classList.remove('show'); });

            settingsToggle.addEventListener('click', () => {
                loadSettings();
                settingsModal.classList.add('show');
            });
            closeSettingsModal.addEventListener('click', () => settingsModal.classList.remove('show'));
            window.addEventListener('click', (e) => { if (e.target === settingsModal) settingsModal.classList.remove('show'); });
            saveSettingsBtn.addEventListener('click', saveSettings);
            exportDataBtn.addEventListener('click', exportData);
            importDataBtn.addEventListener('click', importData);

            dailyNotes.addEventListener('input', () => {
                localStorage.setItem(DAILY_NOTES_KEY, dailyNotes.value);
            });

            // ØªÙ‡ÙŠØ¦Ø©
            loadRegions();
            loadOrders();
            loadSettings();
            populateRegionSelect();
            renderOrders();

            setInterval(renderOrders, 1000);
        })();
    </script>
</body>
</html>


